"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[6678],{10591:(e,r,t)=>{t.r(r),t.d(r,{StreakRecoverModal:()=>W,StreakRecoverOptout:()=>Q,default:()=>J});var n=t(33998),a=t(34900),o=t(22155),s=t(77955),c=t(89113),i=t(94198),u=t(67380),l=t(53823),v=t(83448),p=t(21441),d=t(35001),f=t(56594),b=t(13318),k=t.n(b),m=t(5698),g=t(80009),y=t(77535),h=t(80446),x=t(9495),O=t(42104),w=t(30530),R=t(71623),j=t(36899),C=t(68392),S=t(61663),A=t(57952),P=t(82422),F=t(80244),D=t(58466),N=t(70591),L=t(54883),q=t(37567),E=t(68390);function Z(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function U(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Z(Object(t),!0).forEach((function(r){(0,p.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var B=function(e){var r,t,n,a,s,c,i,u,l,v=e.onAfterClose,p=e.onRequestClose,b=(0,x.d)(),Z=b.isActionsFetched,B=b.completeAction,K=b.checkHasCompleted,T=(n=!1,a=(0,o.useState)(n),s=a[0],c=a[1],[s,function(e){c("boolean"!=typeof e?function(e){return!e}:e)}]),_=(0,f.A)(T,2),I=_[0],$=_[1],z=(0,C.mu)().displayToast,M=(0,S.DX)().logEvent,V=(0,P.g0)().updateAlerts,X=(0,F.Z2)(),Y=X.user,G=X.updateUser,H=(0,D.G)().isStreaksEnabled,Q=(0,m.jE)(),W=(0,h.useRouter)(),J=W.query.streak_restore,ee=(0,g.n)({mutationKey:(0,w.$h)(w.jZ.UserStreakRecover),mutationFn:(u=(0,d.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.e.request(O.qy).then((function(e){return e.recoverStreak}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)}),onSuccess:function(e){M({event_name:A.VB.StreakRecover}),Q.invalidateQueries({queryKey:(0,w.$h)(w.jZ.UserStreak,Y)}),Q.invalidateQueries({queryKey:(0,w.$h)(w.jZ.Transactions,Y),exact:!1}),e.balance&&G(U(U({},Y),{},{balance:e.balance}))},onError:(i=(0,d.A)(k().mark((function e(r){var t,n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=r.response.errors)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.extensions)||void 0===t?void 0:t.code)!==j.hD.BalanceTransactionError){e.next=5;break}if((n=r.response.errors[0]).extensions.status!==q.kr.InsufficientFunds||!n.extensions.balance){e.next=5;break}return e.next=5,G(U(U({},Y),{},{balance:n.extensions.balance}));case 5:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})}),re=(0,o.useCallback)((0,d.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({showRecoverStreak:!1});case 2:case"end":return e.stop()}}),e)}))),[V]),te=(0,y.I)({queryKey:(0,w.$h)(w.jZ.UserStreakRecover),queryFn:(l=(0,d.A)(k().mark((function e(){var r,t;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.e.request(O.Vg);case 2:if(null!=(t=e.sent)&&null!==(r=t.streakRecover)&&void 0!==r&&r.canRecover||!J){e.next=10;break}return e.next=7,re();case 7:z("Oops, you are no longer eligible to restore your streak"),null==p||p(),null==v||v();case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),enabled:!!Y&&H&&!I}),ne=te.data,ae=te.isLoading,oe=(0,o.useCallback)((0,d.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=4;break}return e.next=3,B(R.X2.DisableReadingStreakRecover);case 3:M({event_name:A.VB.DismissStreakRecover});case 4:return e.next=6,re();case 6:null==p||p(),null==v||v();case 8:case"end":return e.stop()}}),e)}))),[B,I,re,M,v,p]),se=(0,o.useCallback)((0,d.A)(k().mark((function e(){var r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Y.balance.amount<ne.streakRecover.cost)){e.next=7;break}return(r=new URLSearchParams).set("origin",A.$e.StreakRecover),E.o||r.set("next",W.pathname),null==W||W.push((0,N.Lz)("".concat(L.ZO,"cores"),r)),e.abrupt("return");case 7:return e.next=9,ee.mutateAsync();case 9:z("Lucky you! Your streak has been restored"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),z("Oops! We are unable to recover your streak. Could you try again later?");case 15:return e.next=17,null==oe?void 0:oe();case 17:case"end":return e.stop()}}),e,null,[[0,12]])}))),[null==ne||null===(r=ne.streakRecover)||void 0===r?void 0:r.cost,z,oe,ee,W,null==Y||null===(t=Y.balance)||void 0===t?void 0:t.amount]),ce=!Z||K(R.X2.DisableReadingStreakRecover);return(0,o.useEffect)((function(){var e;null==ne||null===(e=ne.streakRecover)||void 0===e||!e.canRecover||ce||ae||M({event_name:A.VB.Impression,target_type:A.yK.StreakRecover,target_id:"restore streak"})}),[null==ne?void 0:ne.streakRecover,ce,ae,M]),{hideForever:{isChecked:I,toggle:$},onClose:oe,onRecover:se,recover:U(U({},null==ne?void 0:ne.streakRecover),{},{isLoading:ae,isDisabled:ce,isRecoverPending:ee.isPending})}};var K=t(95412),T=t(74689),_=t(16763),I=t(73855),$=t(96888),z=t(76800),M=["recover"],V=o.createElement,X=function(){return V("div",{className:"overflow-hidden tablet:-mx-4",role:"presentation","aria-hidden":!0},V("img",{alt:"Broken reading streak",className:"h-auto w-full object-contain",loading:"lazy",src:_.R4}))},Y=function(e){var r=e.days;return V(u.o5,{className:"-mx-1 -mb-1 text-center font-bold",tag:u.UL.H3,type:u.kR.Title1,"data-testid":"streak-recover-modal-heading"},"Oh no! Your",V("span",{className:"text-accent-bacon-default"}," ",r," day streak ")," has been broken!")},G=function(e){var r,t=e.recover,n=(0,F.Z2)().user,a=0===t.cost,s=n.balance.amount>=t.cost,c=V("a",{target:"_blank",rel:z.O8,href:L.OC,title:"What are Cores?",className:"text-text-link hover:underline"},"Cores"),i=V(o.Fragment,null,"Lucky you! The first streak restore is on us 🎁. This usually costs"," ",(0,I.rZ)(null!==(r=t.regularCost)&&void 0!==r?r:100)," ",c,". Be sure to come prepared next time!"),l=V(o.Fragment,null,"Maintain your streak!",V("br",null),"Use ",t.cost," ",c," to keep going."),v=V(o.Fragment,null,"You don't have enough ",c," to restore your streak.");return V(u.o5,{className:"text-center",tag:u.UL.P,type:u.kR.Body,"data-testid":"streak-recovery-copy"},a&&i,!a&&(s?l:v))},H=function(e){var r=e.recover,t=(0,a.A)(e,M),o=(0,F.Z2)().user;return V(l.$n,(0,n.A)({},t,{className:"relative gap-1",variant:v.Ak.Primary,size:v.Mp.Large,"data-testid":"streak-recover-button"}),r.cost>o.balance.amount?"Buy Cores":"Restore my streak",V($.t,null),0===r.cost?"Free":(0,I.rZ)(r.cost))},Q=function(e){var r=e.hideForever,t=e.id;return V("div",{className:"flex flex-row items-center justify-center"},V(K.S,{"aria-labelledby":"showAgain-label-".concat(t),checked:r.isChecked,className:"!pr-0","data-testid":"streak-recover-optout",id:"showAgain-".concat(t),name:"showAgain",onToggleCallback:r.toggle}),V(u.o5,{"aria-label":"Never show 'reading streak recover' popup again",className:"cursor-pointer py-2.5 text-text-tertiary",htmlFor:"showAgain-".concat(t),id:"showAgain-label-".concat(t),tag:u.UL.Label,type:u.kR.Footnote},"Never show this again"))},W=function(e){var r=e.isOpen,t=e.onRequestClose,n=e.onAfterClose,a=e.user,u=(0,D.G)().isStreaksEnabled,l=(0,o.useId)(),v=B({onAfterClose:n,onRequestClose:t}),p=v.recover,d=v.hideForever,f=v.onClose,b=v.onRecover;return a&&u&&p.canRecover&&!p.isLoading&&!p.isDisabled?V(i.aF,{isOpen:r,isDrawerOnMobile:r,onRequestClose:f,size:s.rI.XSmall},V(T.O,{"aria-label":"Close streak recover popup",onClick:f,title:"Close streak recover popup"}),V(c.c,{className:"!p-4"},V("div",{className:"flex flex-col gap-4"},V(X,null),V(Y,{days:p.oldStreakLength}),V(G,{recover:p}),V(H,{onClick:b,recover:p,loading:p.isRecoverPending}),V(Q,{id:l,hideForever:d})))):null};const J=W},73855:(e,r,t)=>{t.d(r,{NF:()=>u,PK:()=>s,rZ:()=>i,vv:()=>c});var n=t(21441),a=t(81602);function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var s=function(e){return"string"==typeof e&&"true"===e.toLowerCase()},c=function(e,r){return"number"!=typeof e?"":e.toLocaleString(["en-US"],function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){(0,n.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({minimumFractionDigits:2,maximumFractionDigits:2},r))},i=function(e){return e>1e5?(0,a.Kt)(e):c(e,{minimumFractionDigits:0})},u=function(e){var r=e.currency,t=e.amount;return new Intl.NumberFormat(navigator.language,{minimumFractionDigits:2,maximumFractionDigits:2,style:"currency",currency:r}).format(t)}}}]);